<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Calendar.html</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
<style>
  .bgColor {
      background-color: rgb(166, 219, 240);
  }
</style>
<script>
  'use strict';
  let param = window.location.search;   // '?' ë’¤ì˜ ì¿¼ë¦¬ìŠ¤íŠ¸ë§ì„ ê°€ì ¸ì˜¨ë‹¤.
  let yy, mm;
  // paramë³€ìˆ˜ì— ê°’ì´ ë‹´ê²¨ìˆë‹¤ë©´ ìƒˆë¡œìš´ ë‹¬ë ¥ì˜ ë…„ë„/ì›”ì„ ë³€ê²½ì‹œì¼œì„œ ë‹¤ì‹œ í˜¸ì¶œí•œ ê²½ìš°ì´ë‹¤.
  if(param != "") {
    yy = param.substring(param.indexOf('yy=')+3,param.indexOf('yy=')+7);
    mm = param.substring(param.lastIndexOf('mm=')+3);
  }
  // ì˜¤ëŠ˜ ë‚ ì§œë¥¼ ì „ì—­ë³€ìˆ˜ë¡œ ì €ì¥ì‹œì¼œë†“ê¸°ìœ„í•´ ë‚ ì§œê°ì²´ ìƒì„±í›„ dateë³€ìˆ˜ì— ì˜¤ëŠ˜ ë‚ ì§œë§Œ ë°›ì•˜ë‹¤.
  // ì•ì—ì„œ ë„˜ì–´ì˜¨ 'ë…„ë„(yy)'ì™€ 'ì›”(mm)'ì´ ì¡´ì¬í•œë‹¤ë©´, yearë³€ìˆ˜ì™€ monthë³€ìˆ˜ì— ë„˜ì–´ì˜¨ yyì™€ mmìœ¼ë¡œ ì‚¬ìš©í•˜ê³  ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ ì˜¤ëŠ˜ë‚ ì§œ ìƒì„±ê°ì²´ì˜ ë…„ë„ì™€ ì›”ì„ ì €ì¥í•œë‹¤.
  let today = new Date();
  let year = today.getFullYear();
  let month = today.getMonth() + 1;
  let date = today.getDate();
  let todayYear = year.toString();
  // ì˜¤ëŠ˜ë‚ ì§œì™€ ë„˜ì–´ì˜¨ ë‚ ì§œë¥¼ ë‚˜ì¤‘ì— ì…€ì„ íƒì‹œì— ë¹„êµí•´ì£¼ê¸°ìœ„í•´(ì˜¤ëŠ˜ ì´ì „ì€ ì„ íƒë˜ì§€ ì•Šê²Œí•˜ê¸°ìœ„í•¨) ì˜¤ëŠ˜ë‚ ì§œ(tempToday)ë¥¼ 8ìë¦¬ë¡œ í¸ì§‘í›„ ì €ì¥ì‹œì¼œë‘ì—ˆë‹¤.
  if(month.toString().length == 1) month = '0' + month;
  if(date.length == 1) date = '0' + date;
  let currentToday = year + month + date;
 
  if(param != "") {
    year = yy;
    month = mm;
  }
 
  let ymdLastDate;  // í•´ë‹¹ì›”ì˜ ë§ˆì§€ë§‰ì¼ì ì €ì¥ë³€ìˆ˜
  let sw = 0;
  let firstDate = 0;
  let lastDate = 0;
 
  $(document).ready(function() {
    // ì˜¤ëŠ˜ ë‚ ì§œ êµ¬í•´ì„œ í™”ë©´ì— ì¶œë ¥ì‹œì¼œì£¼ë‹¤.
    let ymd = currentToday.substring(0,4) + "-" + currentToday.substring(4,6) + "-" + currentToday.substring(6);
    $('#todayNalja').html(`<a href="calendar.html">ì˜¤ëŠ˜ ë‚ ì§œ : ${ymd}</a>`);
 
    // ë‹¬ë ¥ê·¸ë¦¬ê¸° í•¨ìˆ˜ í˜¸ì¶œ
    calendarDraw(year, month, 1); // ì²«ë²ˆì§¸ ë‹¬ë ¥ê·¸ë¦¬ê¸°
    calendarDraw(year, parseInt(month)+1, 2); // ë‘ë²ˆì§¸ ë‹¬ë ¥ê·¸ë¦¬ê¸°
 
    // ë…„ë„ êµ¬í•´ì„œ ì„ íƒë°•ìŠ¤ì— ë„£ê¸°
    let strYear = '';
    for(let i=todayYear; i<=parseInt(todayYear)+4; i++) {
      if(i == year) strYear += `<option selected>${year}</option>`;
      else strYear += `<option>${i}</option>`;
    }
    yearSelect.innerHTML = strYear;
    
    // ì›” êµ¬í•´ì„œ ì„ íƒë°•ìŠ¤ì— ë„£ê¸°
    ymdLastDate = new Date(year,month,0).getDate(); // í•´ë‹¹ì›”ì˜ ë§ˆì§€ë§‰ì¼ìêµ¬í•˜ê¸°
    let strMonth = '';
    for(let i=1; i<=12; i++) {
      if(i == month) strMonth += `<option selected>${month}</option>`;
      else {
        let imsiI = i;
        if(i.toString().length == 1) imsiI = '0' + i;
        strMonth += `<option>${imsiI}</option>`;
      }
    }
    monthSelect.innerHTML = strMonth;
 
    // ì‹œì‘ì¼ìì™€ ë§ˆì§€ë§‰ì¼ì ë²”ìœ„ ì„¤ì •í•˜ê¸°
    $('td').click(function() {
 
      // ì˜¤ëŠ˜ ì´ì „ì¼ì„ ì„ íƒí• ìˆ˜ ì—†ê²Œ í•œë‹¤.
      let cellText = evalâ€($(this).text());
      if(cellText.toString().length == 1) cellText = '0' + cellText;
      const tableId = $(this).closest('div').attr('id');
      // console.log(tableId);
      let tempClickToday = '';
      if(tableId == 'calendar1'){ // í´ë¦­í•œê²Œ ì²«ë²ˆì§¸ ë‹¬ë ¥ì´ë©´
        tempClickToday = $('#calendar1 .thisCalendar').text() + cellText;
      }
      else{
        tempClickToday = $('#calendar2 .thisCalendar').text() + cellText;
      }
      tempClickToday = tempClickToday.substring(0,4)+tempClickToday.substring(5);
      // console.log("1",currentToday, tempClickToday);
      if(currentToday > tempClickToday) {
        alert("ì˜¤ëŠ˜ ì´ì „ì¼ì€ ì„ íƒí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        return false;
      }
      else{
        // swê°€ 0ì€ ì‹œì‘ì¼, sw=1ì€ ì¢…ë£Œì¼ì´ë‹¤.
        if(sw == 0) { // ì‹œì‘ì¼ ì„ íƒì‹œ
          lastDate = '';
          $(this).addClass('bgColor');
          firstDate = tempClickToday;
          $('#demo1').html('<b class="text-info">ì˜ˆì•½ì¢…ë£Œì¼ìë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</b>')
          $('#demo2').html(`<b>ì„ íƒëœ ë‚ ì§œ : ${firstDate.substring(0,4)}ë…„ ${firstDate.substring(4,6)}ì›” ${firstDate.substring(6)}ì¼ ~</b>`);
          sw = 1;
        }
        else { // ì¢…ë£Œì¼ ì„ íƒì‹œ
          lastDate = tempClickToday;
          if(firstDate > lastDate) {
            alert("ì‹œì‘ì¼ ì´í›„ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”");
            return false;
          }
          $(this).addClass('bgColor');
          $('#demo1').html(`<b class="text-danger">ì˜ˆì•½ì¼ì : ${firstDate.substring(0,4)}ë…„ ${firstDate.substring(4,6)}ì›” ${firstDate.substring(6)}ì¼ ~ ${lastDate.substring(0,4)}ë…„ ${lastDate.substring(4,6)}ì›” ${lastDate.substring(6)}ì¼</b>`)
          $('#demo2').html(`<b>ì„ íƒëœ ë‚ ì§œ : ${firstDate.substring(0,4)}ë…„ ${firstDate.substring(4,6)}ì›” ${firstDate.substring(6)}ì¼ ~ ${lastDate.substring(0,4)}ë…„ ${lastDate.substring(4,6)}ì›” ${lastDate.substring(6)}ì¼</b>`);
          
          // ì‹œì‘ê³¼ ì¢…ë£Œì‚¬ì´ì…€ë“¤ ìƒ‰ì…íˆê¸°
          let startWeek1 = new Date(year,month-1,1).getDay();
          let startWeek2 = new Date(year,month,1).getDay();
          let ymdLastDate1 = new Date(year,month,0).getDate(); // ì‹œì‘ì›”ì˜ ë§ˆì§€ë§‰ì¼ì
          let ymdLastDate2 = new Date(year,month+1,0).getDate(); // ì¢…ë£Œì›”ì˜ ë§ˆì§€ë§‰ì¼ì
 
          if(firstDate.substring(4,6) == lastDate.substring(4,6)){ // ì‹œì‘ê³¼ ì¢…ë£Œê°€ ê°™ì€ë‹¬ì´ë©´..
            if(tableId == 'calendar1'){
              for(let i=parseInt(firstDate.substring(6))+7+startWeek1; i<parseInt(lastDate.substring(6))+7+startWeek1; i++) {
                $('#calendar1 tr td').eq(i).addClass('bgColor')
              }
            }
            else{
              for(let i=parseInt(firstDate.substring(6))+7+startWeek2; i<parseInt(lastDate.substring(6))+7+startWeek2; i++) {
                $('#calendar2 tr td').eq(i).addClass('bgColor');
              }
            }
          }
          else{ // ì‹œì‘ì›”ì˜ ì¢…ë£Œë‹¬ì´ ë‹¤ë¥¸ë‹¬ì´ë©´..
            for(let i=parseInt(firstDate.substring(6))+7+startWeek1; i<=ymdLastDate1+7+startWeek1; i++) {
              $('#calendar1 tr td').eq(i).addClass('bgColor');
            }
            for(let i=7+startWeek2+1; i<parseInt(lastDate.substring(6))+7+startWeek2; i++) {
              $('#calendar2 tr td').eq(i).addClass('bgColor');
            }
          }
          
        }
      }
 
      
    });  
  });
 
  // ë‹¬ë ¥ê·¸ë¦¬ê¸° í•¨ìˆ˜
  function calendarDraw(year, month, calendar) {
    console.log(year, month, calendar);
    // í•´ë‹¹ì›” 1ì¼ì˜ ìš”ì¼ êµ¬í•˜ê¸°(0:ì¼, 1:ì›”, 2:í™”~~ 6:í† ) : ê°’ì´ ìˆ«ìë¡œ ë„˜ì–´ì˜¨ë‹¤.(í•´ë‹¹ìˆ«ìë§Œí¼ ê³µë°±(td)ì„ ë„£ì–´ì•¼í•œë‹¤.)
    let startWeek = new Date(year,month-1,1).getDay();
    let week = startWeek; // weekë³€ìˆ˜ëŠ” ì¼ì£¼ì¼(7) 1ê°œí–‰ì„ ì²´í¬í•˜ê¸°ìœ„í•œ ë³€ìˆ˜
    
    // í•´ë‹¹ì›”ì˜ ë§ˆì§€ë§‰ì¼ì êµ¬í•˜ê¸°
    ymdLastDate = new Date(year,month,0).getDate();
    //console.log(ymdLastDate);
 
    // ë™ì í…Œì´ë¸” ê·¸ë¦¬ê¸°
    let calendarTable = `<table class="table table-bordered text-center mt-2"><tr><td colspan="7" class="bg-dark text-white thisCalendar">${year}-${('0'+month).slice(-2)}</td></tr><tr><td class="text-danger">ì¼</td><td>ì›”</td><td>í™”</td><td>ìˆ˜</td><td>ëª©</td><td>ê¸ˆ</td><td class="text-primary">í† </td></tr>`;
    
    // calendarTable += `<td colspan="${startWeek}"></td>`;
    for(let i=0; i<startWeek; i++) calendarTable += '<td></td>';
 
    for(let i=1; i<=ymdLastDate; i++) {
      if(week == 0) calendarTable += `<tr><td class="text-danger">${i}</td>`; // ì¼ìš”ì¼
      else if(week == 6) calendarTable += `<td class="text-primary">${i}</td></tr>`; // í† ìš”ì¼
      else calendarTable += `<td>${i}</td>`;
 
      week++;
      if(week == 7) week = 0;
    }
    if(week != 7) {
      for(let i=week; i<7; i++) calendarTable += '<td></td>';
    }
    calendarTable += '</tr></table>';
    if(calendar == '1') $('#calendar1').html(calendarTable);
    else $('#calendar2').html(calendarTable);
    
  }
 
  function calendarCheck() {
    year = document.getElementById("yearSelect").value;
    month = document.getElementById("monthSelect").value;
    // calendarDraw(year, month);
    location.href = `calendar.html?yy=${year}&mm=${month}`;
  }
 
</script>
</head>
<body>
  <div class="container mt-5">
    <h2>ì²«ë²ˆì§¸ë‚ ì§œì™€ ë§ˆì§€ë§‰ ë‚ ì§œë¥¼ í´ë¦­í•˜ì—¬ ë‚ ì§œë²”ìœ„ë¥¼ ì„ íƒí•˜ì„¸ìš”.</h2>
    <p>ğŸ“¢ ì˜¤ëŠ˜ ë‚ ì§œ ì´ì „ì€ ì„ íƒí•˜ì‹¤ ìˆ˜ ì—†ìŠµë‹ˆë‹¤ </p>
    <p id="todayNalja"></p>
    <div class="mb-3">
      <select id="yearSelect" onchange="calendarCheck()"></select>ë…„
      <select id="monthSelect" onchange="calendarCheck()"></select>ì›”
      <input type="button" value="ë‹¤ì‹œì„ íƒ" onclick="location.reload();" class="btn btn-dark btn-sm">
    </div>
 
    <div class="row">
      <div id="calendar1" class="col"></div>
      <div id="calendar2" class="col"></div>
    </div>
 
    <div id="demo1">ğŸ“…ì˜ˆì•½í•˜ì‹¤ ì‹œì‘ì¼ìë¥¼ ì„ íƒí•˜ì„¸ìš”.</div>
    <div id="demo2"></div>
  </div>
</body>
</html>
